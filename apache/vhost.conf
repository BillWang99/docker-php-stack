ServerName localhost

<VirtualHost *:80>
    DocumentRoot "/var/www/html"
    DirectoryIndex index.php index.html
    
    <Directory "/var/www/html">
        AllowOverride All
        Require all granted
        Options Indexes FollowSymLinks
    </Directory>

    # 支援多個 Laravel 專案子目錄
    RewriteEngine On
    
    # 處理 /project_name 請求到 /project_name/public/
    RewriteCond %{REQUEST_URI} ^/([^/]+)
    RewriteCond %{DOCUMENT_ROOT}/%1/public/index.php -f
    RewriteCond %{REQUEST_URI} !^/[^/]+/public/
    RewriteRule ^/([^/]+)(/.*)?$ /$1/public$2 [L]

    # 通用設定允許所有專案的 public 目錄
    <DirectoryMatch "^/var/www/html/.+/public">
        AllowOverride All
        Require all granted
        Options Indexes FollowSymLinks
        
        # Laravel 路由處理
        RewriteEngine On
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^ index.php [L]
    </DirectoryMatch>

    # PHP-FPM 代理設定
    <FilesMatch \.php$>
        SetHandler "proxy:fcgi://php:9000"
    </FilesMatch>

    ErrorLog /proc/self/fd/2
    CustomLog /proc/self/fd/1 common
</VirtualHost>